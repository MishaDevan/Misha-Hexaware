use Techshop

create table customers (customerId int primary key ,firstName varchar(50),lastName varchar(50),email varchar(100),phone varchar(15),address varchar(255));

create table products (productId int primary key ,productName varchar(100),description varchar(255),price decimal(10, 2));

create table Orders (Orderid int primary key, CUstomerID int ,Orderdate date, totalAMount decimal(10,2), foreign key (customerid) references Customers(customerid));

create table Orderdetails (OrderDetailID int primary key, OrderID int, Productid int,quantity int, foreign key (orderid) references orders(orderid),foreign key (productid) references products(productid));

create table inventory (inventoryId int primary key,productId int,quantityInStock int,lastStockUpdate datetime default getdate(),foreign key (productId) references products(productId));


insert into customers (customerId, firstName, lastName, email, phone, address)
values 
(1, 'john', 'doe', 'john.doe@example.com', '1234567890', '123 main st'),
(2, 'jane', 'smith', 'jane.smith@example.com', '9876543210', '456 elm st'),
(3, 'alice', 'johnson', 'alice.j@example.com', '1112223333', '789 oak st'),
(4, 'bob', 'brown', 'bob.brown@example.com', '4445556666', '101 pine st'),
(5, 'charlie', 'davis', 'charlie.d@example.com', '7778889999', '202 birch st'),
(6, 'diana', 'evans', 'diana.ev@example.com', '5556667777', '303 cedar st'),
(7, 'eve', 'wilson', 'eve.wil@example.com', '9990001111', '404 spruce st'),
(8, 'frank', 'garcia', 'frank.g@example.com', '2223334444', '505 maple st'),
(9, 'grace', 'hall', 'grace.h@example.com', '3334445555', '606 ash st'),
(10, 'hank', 'king', 'hank.k@example.com', '8889990000', '707 fir st');

insert into products (productId, productName, description, price)
values 
(1, 'laptop', '14-inch screen, 8gb ram', 800.00),
(2, 'smartphone', '6-inch screen, 128gb storage', 600.00),
(3, 'tablet', '10-inch screen, 64gb storage', 300.00),
(4, 'smartwatch', 'heart rate monitor, gps', 150.00),
(5, 'headphones', 'noise-canceling, wireless', 120.00),
(6, 'keyboard', 'mechanical, backlit', 80.00),
(7, 'mouse', 'wireless, ergonomic', 40.00),
(8, 'monitor', '24-inch, full hd', 200.00),
(9, 'printer', 'laser, wireless', 250.00),
(10, 'speaker', 'bluetooth, portable', 100.00);

insert into orders (orderId, customerId, orderDate, totalAmount)
values 
(1, 1, '2025-04-01', 800.00),
(2, 2, '2025-04-02', 900.00),
(3, 3, '2025-04-03', 1200.00),
(4, 4, '2025-04-04', 150.00),
(5, 5, '2025-04-05', 300.00),
(6, 6, '2025-04-06', 400.00),
(7, 7, '2025-04-07', 600.00),
(8, 8, '2025-04-08', 250.00),
(9, 9, '2025-04-09', 120.00),
(10, 10, '2025-04-10', 700.00);


insert into orderDetails (orderDetailId, orderId, productId, quantity)
values 
(1, 1, 1, 1),
(2, 2, 2, 2),
(3, 3, 3, 1),
(4, 4, 4, 2),
(5, 5, 5, 1),
(6, 6, 6, 1),
(7, 7, 7, 2),
(8, 8, 8, 1),
(9, 9, 9, 1),
(10, 10, 10, 2);


insert into inventory (inventoryId, productId, quantityInStock)
values 
(1, 1, 50),
(2, 2, 100),
(3, 3, 30),
(4, 4, 20),
(5, 5, 80),
(6, 6, 60),
(7, 7, 40),
(8, 8, 70),
(9, 9, 90),
(10, 10, 110);


select * from customers;
select * from products;
select * from orders;
select * from orderDetails;
select * from inventory;

---------------------------------------------TASK 4--------------------------------------
-----------1.Customers who have not placed order------------------------------

select c.CustomerID ,c.FirstName,c.Lastname from customers c
left join Orders o on c.CustomerID= o.CustomerID where o.OrderID is null;

-----------------2.Total no. of products available for sale--------------------

select count(*) as totalProductsfrom products;

------------------3.Total revenue generated by techshop-------------------------

select sum(TotalAmount) as TotalRevenue from orders ;

-------------------4.Avg quantity ordered for products in specific category------

select avg(od.quantity) as avdOrderQuantity from orderdetails od
join products p on od.productID = p.productID
where p.Productname = 'Laptop';

--------------------5.Total revenue generated by a specific customer-------------

select sum(o.totalamount) as totalrevenue
from orders o 
where o.CustomerID=3;

---------------------6.customers with most orders---------------------------------

select top 1 c.firstname,c.lastname,count(o.orderid) as ordercount from customers c
join orders o on c.CustomerID =o.customerid
group by c.CustomerID,c.firstname,c.Lastname order by ordercount desc ;

-------------------7.most popular product---------------------------------------

select top 1 p.productname,sum(od.quantity) as totalQuantity from OrderDetails od 
join products p on od.ProductID = p.ProductId 
group by p.ProductId,p.Productname
order by totalQuantity desc;

--------------------8.customer who has spent more money --------------------------

select top 1 c.firstname,c.lastname,sum(o.totalamount) as totalspending from customers c
join orders o on c.CustomerID=o.CustomerID
group by c.CustomerID,c.FirstName,c.Lastname 
order by totalspending desc;

------------------9.avg order value--------------------------------------------------

select avg(o.totalAmount) as avgOrderValue from orders o;
--------------------10.total no. of orders placed by each customer-------------------

select c.firstname,c.lastname,count(o.orderid) as orderCount from Customers c
left join orders o on c.customerid = o.CustomerID
group by c.customerid , c.FirstName,c.Lastname;

----------------------------------------------------------------------TASK 3-----------------------------------------------------

----------------1.all orders along with customer info ------------------------------
select o.orderid,o.orderDate,o.totalAmount,c.firstname,c.lastname,c.email,c.phone from orders o 
join customers c on o.customerId=c.customerId;

----------------2.total revenue generated by each product--------------------

select p.productname ,sum(od.quantity * price) as totalrevenue from orderdetails od
join products p on od.productid = p.productid 
group by p.productname;

----------------3.all customers who made at least one purchase--------------------------

select c.firstname,c.lastname,c.email,c.phone from customers c
join orders o on c.customerId=o.customerId;

-----------------4.most popular gadget ---------------------------------------------------------

select top 1 p.productname, sum(od.quantity) as totalquantity from orderDetails od 
join products p on od.productId = p.productId 
group by p.productName 
order by totalquantity desc;

---------------------5.list of all electronic gadgets---------------------

select productid,productname,description from products;

----------------------6.avg order value for each customer----------------------------

select c.firstname,c.lastname ,avg(o.totalamount) as averageOrderValue from customers c
join orders o on c.customerId= o.customerId 
group by c.customerId,c.firstName,c.lastName;

----------------------7.order with highest total revenue-------------------------------------

select o.orderid,o.totalamount,c.firstname,c.lastname,c.email,c.phone from orders o
join customers c on o.customerId =c.customerId 
order by o.totalAmount desc;

---------------------8.list of gadgets and the no. of times each product has been ordered------------

select p.productname,count(od.orderdetailID) as timesordered from orderdetails od
join products p on od.productId = p.productid
group by p.productname;

----------------------9.customers who purchased a specific gadget (input as parameter) ---------------------------------

select c.firstname,c.lastname,c.email,c.phone from customers c 
join orders o on c.customerid =o.customerId
join orderDetails od on o.orderId= od.orderId
join products p on od.productid = p.productId
where p.productName = 'Laptop';

--------------------10.total revenue generated by all orders within a specific time -----------------------------
select * from orders;

select sum(totalAmount) as totalRevenue
from orders 
where orderDate between '2025-04-01' and '2025-04-07';

---------------------------------------------------------------TASK 2-----------------------------------------------------------------------

----------------------------------1.RETRIEVE NAMES AND EMAILS OF CUSTOMERS-----------------------------------

select c.firstname+' '+ c.lastname as customerName,c.email from customers c ;

-------------------------------2.list all orders with their order dates and corresponding customer names-------------------------

select O.orderid,c.firstname+' '+ c.lastname as CustomerName ,o.orderdate from customers c
join orders o on o.customerId = c.customerId;

--------------------------------3.Insert a new customer record into customers------------------------------------------------
select * from customers
insert into Customers values(11,'Misty','kellar','Misty12@example.com','12345890','123 main street');

--------------------------------4.update the prices of all gadget in products table by increasing them by 10%----------------------------

update products 
set price = price *1.10;

--------------------------------5.delete a specific orders and its associated details-------------------------------------------------------

delete from orderDetails where orderid =10;
delete from orders where orderid =10;

-------------------------------6.insert a new order into orders table------------------------------

insert into orders values(10,10,'2025-04-10',500.00);

------------------------------7.update the contact information of a specific customer---------------------------

update customers 
set email = 'mistykell@example.com', address= '1234 next street'
where customerid =11;

-----------------------------8.recalculate and update the total cost of each other--------------------------------------------

update orders 
set totalAmount = ( select sum(od.quantity * p.price) from orderdetails od
join products p on od.productId =p.productId 
where od.orderId =orders.orderId);

------------------------------9.Delete all orders and their associated order details for a specific customer

delete from orderDetails 
where orderid in (select orderid from orders where customerid =1);

delete from orders where customerId =1;

--------------------------------10.insert new gadget into products table-------------------------------------------
select * from products
insert into products values (11,'Gaming console', 'High performance console for gaming',400.00);

-------------------------------11. update status of a specificc order in orders table ---------------------------------------
select * from orders
update order

-----------------------------12. calculate and update number of orders placed by each customer----------------------------

alter table customers add ordercount int default 0;

update customers set ordercount = ( select count(*) from orders 
where orders.customerid =customers.customerid);



 